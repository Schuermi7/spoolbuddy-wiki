<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="SpoolBuddy Troubleshooting - Common issues and solutions.">
  <title>Troubleshooting - SpoolBuddy Wiki</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://spoolbuddy.cool/assets/img/spoolbuddy_logo_dark.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/wiki.css">
</head>
<body>
  <div class="scroll-progress"></div>
  <nav class="navbar">
    <div class="nav-container">
      <a href="https://spoolbuddy.cool" class="nav-logo"><img src="https://spoolbuddy.cool/assets/img/spoolbuddy_logo_dark.png" alt="SpoolBuddy" class="logo-img"></a>
      <button class="nav-toggle" aria-label="Toggle navigation"><span></span><span></span><span></span></button>
      <div class="nav-links">
        <a href="https://spoolbuddy.cool" class="nav-link">Home</a>
        <a href="https://spoolbuddy.cool/features.html" class="nav-link">Features</a>
        <a href="index.html" class="nav-link active">Docs</a>
        <a href="https://discord.gg/3XFdHBkF" class="nav-cta nav-discord" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419s.956-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419s.955-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/></svg>Discord</a>
        <a href="https://github.com/maziggy/spoolbuddy" class="nav-cta" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>GitHub</a>
      </div>
    </div>
  </nav>

  <section class="wiki-hero">
    <div class="container">
      <h1><span class="text-gradient">Troubleshooting</span></h1>
      <p>Common issues and solutions for SpoolBuddy hardware and software.</p>
    </div>
  </section>

  <section class="wiki-content">
    <div class="container">
      <div class="doc-layout">
        <aside class="doc-sidebar">
          <h4>On This Page</h4>
          <ul>
            <li><a href="#pn5180">PN5180 NFC Issues</a></li>
            <li><a href="#nau7802">Scale Issues</a></li>
            <li><a href="#display">Display Issues</a></li>
            <li><a href="#firmware">Firmware Issues</a></li>
            <li><a href="#backend">Backend Issues</a></li>
            <li><a href="#printer">Printer Connection</a></li>
            <li><a href="#commands">Diagnostic Commands</a></li>
          </ul>
          <h4>Documentation</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="hardware.html">Hardware Required</a></li>
            <li><a href="wiring.html">Wiring Guide</a></li>
            <li><a href="assembly.html">Assembly Guide</a></li>
            <li><a href="firmware.html">Firmware</a></li>
            <li><a href="software.html">Software Setup</a></li>
            <li><a href="troubleshooting.html" class="active">Troubleshooting</a></li>
          </ul>
        </aside>

        <main class="doc-content">
          <h2 id="pn5180">PN5180 NFC Issues</h2>

          <h3>PN5180 Not Responding</h3>
          <p><strong>Symptoms:</strong> No tag detection, SPI timeout errors, "PN5180 not found"</p>

          <h4>Solutions:</h4>
          <ol>
            <li><strong>Verify wiring</strong> - Check all 8 connections against <a href="wiring.html">Wiring Guide</a></li>
            <li><strong>Don't use J9!</strong> - MISO/MOSI must NOT be connected to J9 (conflicts with LCD)</li>
            <li><strong>Check voltage</strong> - Measure 3.3V at PN5180 VCC pin (NOT 5V!)</li>
            <li><strong>Verify RST pin</strong> - Should be HIGH (3.3V) during operation</li>
            <li><strong>Reduce SPI speed</strong> - Try 500kHz for testing</li>
          </ol>

          <h3>Tags Not Detected</h3>
          <ul>
            <li><strong>Tag compatibility:</strong> Bambu Lab tags are ISO 15693. RC522 does NOT work!</li>
            <li><strong>Antenna position:</strong> Center under spool core, &lt;20cm from tag</li>
            <li><strong>Interference:</strong> Move away from WiFi router, metal surfaces</li>
          </ul>

          <h2 id="nau7802">Scale Issues</h2>

          <h3>NAU7802 Erratic Readings</h3>
          <p><strong>Symptoms:</strong> Weight jumps around, negative values, drifting readings</p>

          <h4>Solutions:</h4>
          <ol>
            <li><strong>Check load cell wiring:</strong> If readings inverted, swap A+ and A- wires</li>
            <li><strong>Stable power:</strong> Use quality USB-C cable and 5V/2A power supply</li>
            <li><strong>Mechanical issues:</strong> Platform must only connect via load cell (no touching sides)</li>
            <li><strong>Allow warm-up:</strong> NAU7802 needs ~1 minute to stabilize</li>
            <li><strong>Shield from drafts:</strong> Air currents affect readings</li>
          </ol>

          <h3>Negative Weight</h3>
          <ul>
            <li>Swap A+ and A- wires</li>
            <li>Or configure offset in software</li>
            <li>Tare after fixing</li>
          </ul>

          <h2 id="display">Display Issues</h2>

          <h3>Blank Screen</h3>
          <ul>
            <li><strong>Power:</strong> Try different USB-C cable (must be data capable)</li>
            <li><strong>Firmware:</strong> Flash with correct board settings, PSRAM enabled</li>
            <li><strong>Reset:</strong> Press RST button</li>
          </ul>

          <h3>Touch Not Working</h3>
          <ul>
            <li>GT911 touch controller is internal</li>
            <li>Check LVGL touch driver initialization</li>
            <li>May need I2C address configuration</li>
          </ul>

          <h2 id="firmware">Firmware Issues</h2>

          <h3>Upload Fails</h3>
          <table>
            <tr><th>Issue</th><th>Solution</th></tr>
            <tr><td>No port detected</td><td>Try different USB-C cable (some are charge-only)</td></tr>
            <tr><td>Timeout errors</td><td>Set DIP switches: S0=ON, S1=OFF</td></tr>
            <tr><td>Permission denied</td><td>Add user to dialout group (Linux)</td></tr>
            <tr><td>Wrong board</td><td>Select ESP32S3 Dev Module</td></tr>
          </table>

          <h3>No Serial Output</h3>
          <ul>
            <li>Build with <code>ARDUINO_USB_CDC_ON_BOOT=1</code></li>
            <li>Check baud rate: 115200</li>
            <li>Press RST button after upload</li>
          </ul>

          <h2 id="backend">Backend Issues</h2>

          <h3>Server Won't Start</h3>
          <pre><code># Check logs
journalctl -u spoolbuddy -n 50

# Common fixes:
# Port in use
sudo lsof -i :3000

# Missing dependencies
pip install -r requirements.txt

# Database permissions
chmod 664 spoolbuddy.db</code></pre>

          <h3>WebSocket Disconnects</h3>
          <ul>
            <li>Check Pi resources: <code>htop</code></li>
            <li>Check network stability</li>
            <li>Increase WebSocket ping interval</li>
          </ul>

          <h2 id="printer">Printer Connection Issues</h2>

          <h3>Can't Connect to Printer</h3>
          <p><strong>Symptoms:</strong> "Connection refused", MQTT timeout</p>

          <h4>Verify:</h4>
          <ol>
            <li><strong>Network:</strong> Pi and printer on same network<br>
              <code>ping 192.168.1.50</code> (your printer IP)</li>
            <li><strong>Credentials:</strong> Serial number and access code correct</li>
            <li><strong>Printer settings:</strong> LAN mode enabled, not in sleep mode</li>
            <li><strong>Port:</strong> MQTT uses port 8883<br>
              <code>nc -zv 192.168.1.50 8883</code></li>
          </ol>

          <h2 id="commands">Diagnostic Commands</h2>

          <h3>Check Hardware</h3>
          <pre><code># I2C scan (should show NAU7802 at 0x2A)
i2cdetect -y 1

# Check USB devices
lsusb

# Check serial ports
ls /dev/tty*</code></pre>

          <h3>Check Services</h3>
          <pre><code># SpoolBuddy service
sudo systemctl status spoolbuddy

# View logs
journalctl -u spoolbuddy -f

# Restart service
sudo systemctl restart spoolbuddy</code></pre>

          <h3>Check Network</h3>
          <pre><code># Pi IP address
ip addr

# Ping printer
ping -c 5 192.168.1.50

# Check ports
netstat -tlnp | grep 3000</code></pre>

          <h3>Check API</h3>
          <pre><code># Health check
curl http://localhost:3000/api/health

# List printers
curl http://localhost:3000/api/printers

# Current weight
curl http://localhost:3000/api/scale/weight</code></pre>

          <h2>Getting Help</h2>
          <p>If you're still stuck:</p>
          <ol>
            <li><strong>Check the logs</strong> - Usually contains the answer</li>
            <li><strong>Search GitHub Issues</strong> - Someone may have had the same problem</li>
            <li><strong>Join Discord</strong> - <a href="https://discord.gg/3XFdHBkF" target="_blank" rel="noopener">discord.gg/3XFdHBkF</a></li>
            <li><strong>Open an Issue</strong> - Include logs and hardware details</li>
          </ol>

          <nav class="doc-nav">
            <a href="software.html">
              <span>Previous</span>
              <span>Software Setup</span>
            </a>
            <a href="index.html" class="next">
              <span>Back to</span>
              <span>Documentation Home</span>
            </a>
          </nav>
        </main>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">
        <p>SpoolBuddy is open source under the MIT License.</p>
        <div class="footer-social">
          <a href="https://github.com/maziggy/spoolbuddy" target="_blank" rel="noopener" aria-label="GitHub"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a>
          <a href="https://discord.gg/3XFdHBkF" target="_blank" rel="noopener" aria-label="Discord"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419s.956-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419s.955-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/></svg></a>
        </div>
      </div>
    </div>
  </footer>

  <script src="js/main.js"></script>
</body>
</html>
