<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="SpoolBuddy Firmware Installation - Flash the ESP32 firmware.">
  <title>Firmware Installation - SpoolBuddy Wiki</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://spoolbuddy.cool/assets/img/spoolbuddy_logo_dark.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/wiki.css">
</head>
<body>
  <div class="scroll-progress"></div>
  <nav class="navbar">
    <div class="nav-container">
      <a href="https://spoolbuddy.cool" class="nav-logo"><img src="https://spoolbuddy.cool/assets/img/spoolbuddy_logo_dark.png" alt="SpoolBuddy" class="logo-img"></a>
      <button class="nav-toggle" aria-label="Toggle navigation"><span></span><span></span><span></span></button>
      <div class="nav-links">
        <a href="https://spoolbuddy.cool" class="nav-link">Home</a>
        <a href="https://spoolbuddy.cool/features.html" class="nav-link">Features</a>
        <a href="index.html" class="nav-link active">Docs</a>
        <a href="https://discord.gg/3XFdHBkF" class="nav-cta nav-discord" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419s.956-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419s.955-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/></svg>Discord</a>
        <a href="https://github.com/maziggy/spoolbuddy" class="nav-cta" target="_blank" rel="noopener"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>GitHub</a>
      </div>
    </div>
  </nav>

  <section class="wiki-hero">
    <div class="container">
      <h1>Firmware <span class="text-gradient">Installation</span></h1>
      <p>Flash the ESP32 firmware using PlatformIO or Arduino IDE.</p>
    </div>
  </section>

  <section class="wiki-content">
    <div class="container">
      <div class="doc-layout">
        <aside class="doc-sidebar">
          <h4>On This Page</h4>
          <ul>
            <li><a href="#prerequisites">Prerequisites</a></li>
            <li><a href="#platformio">PlatformIO Setup</a></li>
            <li><a href="#arduino">Arduino IDE Setup</a></li>
            <li><a href="#config">Board Configuration</a></li>
            <li><a href="#connect">Connecting</a></li>
            <li><a href="#flash">Flashing</a></li>
            <li><a href="#verify">Verification</a></li>
          </ul>
          <h4>Documentation</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="hardware.html">Hardware Required</a></li>
            <li><a href="wiring.html">Wiring Guide</a></li>
            <li><a href="assembly.html">Assembly Guide</a></li>
            <li><a href="firmware.html" class="active">Firmware</a></li>
            <li><a href="software.html">Software Setup</a></li>
            <li><a href="troubleshooting.html">Troubleshooting</a></li>
          </ul>
        </aside>

        <main class="doc-content">
          <h2 id="prerequisites">Prerequisites</h2>
          <ul>
            <li>SpoolBuddy fully assembled (see <a href="assembly.html">Assembly Guide</a>)</li>
            <li>USB-C cable (data capable, not charge-only)</li>
            <li>Computer with USB port</li>
            <li>PlatformIO or Arduino IDE installed</li>
          </ul>

          <h2 id="platformio">Option A: PlatformIO (Recommended)</h2>
          <p>PlatformIO provides the best development experience with automatic library management.</p>

          <h3>1. Install VS Code</h3>
          <p>Download from <a href="https://code.visualstudio.com/" target="_blank" rel="noopener">code.visualstudio.com</a></p>

          <h3>2. Install PlatformIO Extension</h3>
          <ol>
            <li>Open VS Code</li>
            <li>Go to Extensions (Ctrl+Shift+X)</li>
            <li>Search "PlatformIO"</li>
            <li>Install "PlatformIO IDE"</li>
          </ol>

          <h3>3. Clone the Repository</h3>
          <pre><code>git clone https://github.com/maziggy/spoolbuddy.git
cd spoolbuddy/firmware</code></pre>

          <h3>4. Open Project</h3>
          <p>In VS Code: File → Open Folder → select <code>firmware/</code></p>
          <p>PlatformIO will detect the project and install dependencies.</p>

          <h2 id="arduino">Option B: Arduino IDE</h2>

          <h3>1. Install Arduino IDE 2.x</h3>
          <p>Download from <a href="https://www.arduino.cc/en/software" target="_blank" rel="noopener">arduino.cc</a></p>

          <h3>2. Add ESP32 Board Support</h3>
          <ol>
            <li>File → Preferences</li>
            <li>Add to "Additional Board Manager URLs":<br>
              <code>https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json</code></li>
            <li>Tools → Board → Boards Manager</li>
            <li>Search "esp32" and install "esp32 by Espressif Systems"</li>
          </ol>

          <h3>3. Install Required Libraries</h3>
          <p>Sketch → Include Library → Manage Libraries. Install:</p>
          <ul>
            <li><code>lvgl</code> (v8.3.x)</li>
            <li><code>TFT_eSPI</code></li>
            <li><code>SparkFun_Qwiic_Scale_NAU7802</code></li>
            <li><code>ArduinoJson</code></li>
            <li><code>WiFiManager</code></li>
          </ul>

          <h2 id="config">Board Configuration</h2>

          <h3>PlatformIO (platformio.ini)</h3>
          <pre><code>[env:crowpanel-7]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_upload.flash_size = 16MB
board_build.partitions = default_16MB.csv

build_flags =
    -D LV_CONF_INCLUDE_SIMPLE
    -D BOARD_HAS_PSRAM
    -D ARDUINO_USB_CDC_ON_BOOT=1

monitor_speed = 115200
upload_speed = 921600</code></pre>

          <h3>Arduino IDE Settings</h3>
          <ul>
            <li>Board: "ESP32S3 Dev Module"</li>
            <li>Flash Size: "16MB"</li>
            <li>PSRAM: "OPI PSRAM"</li>
            <li>USB Mode: "Hardware CDC and JTAG"</li>
            <li>Upload Speed: "921600"</li>
          </ul>

          <h2 id="connect">Connecting to Computer</h2>

          <h3>DIP Switch Settings</h3>
          <p>Before connecting, check the DIP switches on the back of the CrowPanel:</p>
          <table>
            <tr><th>Mode</th><th>S1</th><th>S0</th><th>Use</th></tr>
            <tr><td>Normal</td><td>OFF</td><td>OFF</td><td>Running firmware</td></tr>
            <tr><td><strong>Upload</strong></td><td><strong>OFF</strong></td><td><strong>ON</strong></td><td>Flash new firmware</td></tr>
            <tr><td>Debug</td><td>ON</td><td>OFF</td><td>Serial debugging</td></tr>
          </table>

          <div class="alert alert-warning">
            <strong>Set S0=ON, S1=OFF for uploading.</strong>
          </div>

          <h3>USB Connection</h3>
          <ol>
            <li>Connect USB-C cable to CrowPanel</li>
            <li>Connect other end to computer</li>
            <li>Display may show blank or old firmware</li>
          </ol>

          <h3>Finding the Port</h3>
          <p><strong>Windows:</strong> Device Manager → Ports (COM & LPT) → Look for "USB Serial" (e.g., COM3)</p>
          <p><strong>Linux:</strong> <code>ls /dev/ttyACM* /dev/ttyUSB*</code> (usually /dev/ttyACM0)</p>
          <p><strong>macOS:</strong> <code>ls /dev/cu.usb*</code> (usually /dev/cu.usbmodem*)</p>

          <h2 id="flash">Flashing the Firmware</h2>

          <h3>Using PlatformIO</h3>
          <ol>
            <li><strong>Build:</strong> Click the checkmark (✓) or run <code>pio run</code></li>
            <li><strong>Upload:</strong> Click the arrow (→) or run <code>pio run -t upload</code></li>
            <li><strong>Monitor:</strong> Click the plug icon or run <code>pio device monitor</code></li>
          </ol>

          <h3>Using Arduino IDE</h3>
          <ol>
            <li>Select board and port in Tools menu</li>
            <li>Click Verify (checkmark) to compile</li>
            <li>Click Upload (right arrow)</li>
            <li>Open Serial Monitor (Tools → Serial Monitor) at 115200 baud</li>
          </ol>

          <h2 id="verify">Verification</h2>

          <h3>Expected Serial Output</h3>
          <pre><code>SpoolBuddy Firmware v1.0.0
==========================

[INIT] Starting display...
[INIT] Display initialized: 800x480
[INIT] Starting I2C...
[INIT] NAU7802 found at 0x2A
[INIT] Starting SPI...
[INIT] PN5180 detected
[INIT] Connecting to WiFi...
[WIFI] Connected: 192.168.1.45
[WS] Connecting to ws://192.168.1.100:3000/ws/ui
[WS] Connected!
[READY] SpoolBuddy ready</code></pre>

          <h3>Verification Tests</h3>
          <ul class="checklist">
            <li>Display backlight on and LVGL UI renders</li>
            <li>Touch responds to input</li>
            <li>Scale shows weight readings</li>
            <li>NFC detects tags when spool placed</li>
            <li>WebSocket connects to backend</li>
          </ul>

          <h2>Troubleshooting Upload</h2>
          <ul>
            <li><strong>Upload fails:</strong> Check DIP switches (S0=ON, S1=OFF)</li>
            <li><strong>No port detected:</strong> Try different USB cable (must be data cable)</li>
            <li><strong>Timeout errors:</strong> Hold BOOT button while connecting USB</li>
            <li><strong>Slow upload:</strong> Reduce upload_speed to 460800 or 115200</li>
          </ul>

          <nav class="doc-nav">
            <a href="assembly.html">
              <span>Previous</span>
              <span>Assembly Guide</span>
            </a>
            <a href="software.html" class="next">
              <span>Next</span>
              <span>Software Setup</span>
            </a>
          </nav>
        </main>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-bottom">
        <p>SpoolBuddy is open source under the MIT License.</p>
        <div class="footer-social">
          <a href="https://github.com/maziggy/spoolbuddy" target="_blank" rel="noopener" aria-label="GitHub"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg></a>
          <a href="https://discord.gg/3XFdHBkF" target="_blank" rel="noopener" aria-label="Discord"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419s.956-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419s.955-2.419 2.157-2.419 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"/></svg></a>
        </div>
      </div>
    </div>
  </footer>

  <script src="js/main.js"></script>
</body>
</html>
